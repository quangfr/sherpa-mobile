<!DOCTYPE html><html lang="fr"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="theme-color" content="#151515"/><link rel="manifest" href="manifest.json"/><link rel="icon" type="image/png" sizes="192x192" href="192.png"/><link rel="icon" type="image/png" sizes="512x512" href="512.png"/><link rel="apple-touch-icon" href="192.png"/><title>SHERPA — MVP v6.0.0</title><link rel="stylesheet" href="app.css"/><script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script></head><body>
<div class="auth-gate hidden" id="auth-gate"><div class="auth-card"><img class="auth-logo" src="logo.gif" alt="Logo Sherpa"/><h1>Bienvenue sur Sherpa</h1><p class="auth-sub">Connectez-vous pour accéder à vos données.</p><form class="auth-password" id="password-login-form"><label for="password-email">Connexion email</label><input id="password-email" type="email" placeholder="vous@example.com" autocomplete="email" required/><label for="password-password">Mot de passe</label><input id="password-password" type="password" placeholder="Votre mot de passe" autocomplete="current-password" required/><div class="auth-actions"><button class="btn primary" type="submit">Se connecter</button><button class="btn" type="button" id="btn-offline-mode">Mode hors-ligne</button></div></form><button class="auth-link" type="button" id="btn-password-reset">Mot de passe oublié ?</button><div class="auth-feedback" id="password-feedback"></div><div class="auth-feedback error" id="auth-error"></div></div></div>
<header><div class="wrap header-bar"><div class="header-left"><nav class="tabs" id="tabs"></nav></div><div class="header-actions"><button class="btn small" id="btn-sync-indicator" title="Synchronisation" aria-label="Synchronisation">⚠️</button><div class="auth-user hidden" id="auth-user"><button class="btn small" type="button" id="btn-sign-out" aria-label="Se déconnecter"><span class="icon">🔒</span></button></div></div></div></header>
<main class="wrap">
<!-- DASHBOARD -->
<section class="view" id="view-dashboard">
<div class="dashboard-toolbar"><button class="btn small primary" id="btn-dashboard-new-consultant">Ajouter un consultant</button></div>
<div class="grid g4">
<div class="card"><div class="row space"><div class="title">🚨 Alertes actives</div><div class="pill" id="db-alerte-title">0</div></div><div id="db-alerte-list" class="db-list"></div></div>
<div class="card"><div class="row space"><div class="title">⏳ Fin de mission &lt; <span id="db-fin-x"></span>j</div><div class="pill" id="db-fin-title">0</div></div><div id="db-fin-list" class="db-list"></div></div>
<div class="card"><div class="row space"><div class="title">🐕‍🦺 Sans action STB &gt; <span id="db-stb-y"></span>j</div><div class="pill" id="db-stb-title">0</div></div><div id="db-stb-list" class="db-list"></div></div>
<div class="card"><div class="row space"><div class="title">🗣️ Sans avis &gt; <span id="db-avis-z"></span>j</div><div class="pill" id="db-avis-title">0</div></div><div id="db-avis-list" class="db-list"></div></div>
<div class="grid g2 dashboard-actions" style="grid-column:1/-1">
  <div class="card" id="db-actions-recent-card">
    <div class="row space" style="margin-bottom:6px"><div class="title">⏳ Actions en cours</div><div class="pill" id="db-actions-recent-count">0</div></div>
    <div id="db-actions-recent-list" class="db-list"></div>
  </div>
  <div class="card" id="db-actions-upcoming-card">
    <div class="row space" style="margin-bottom:6px"><div class="title">📅 Actions à venir</div><div class="pill" id="db-actions-upcoming-count">0</div></div>
    <div id="db-actions-upcoming-list" class="db-list"></div>
  </div>
</div>
</div>
</section>
<!-- ACTIVITÉ -->
<section class="view" id="view-activite" style="overflow:hidden">
<div class="pane" id="acts-pane">
  <div class="pane-header">
    <div class="row header-line">
      <div class="row header-main" style="gap:10px">
        <div class="title">📌 Activités</div>
        <div class="pill" id="activities-count">0</div>
        <button class="btn small primary" id="btn-new-activity">Ajouter</button>
        <button class="btn small" id="btn-reset-filters">Réinitialiser</button>
      </div>
      <div class="row filters-line">
        <select class="filter-select" data-filter="consultant" id="filter-consultant" title="Filtrer par consultant" aria-label="Filtrer par consultant">
          <option value="">👤Tous</option>
        </select>
        <select class="filter-select" data-filter="type" id="filter-type" title="Filtrer par type" aria-label="Filtrer par type">
          <option value="">🗂️ Tous</option>
          <option value="ACTION_ST_BERNARD">🐕‍🦺 Action STB</option>
          <option value="CORDEE">🪢 Cordée</option>
          <option value="NOTE">📝 Note</option>
          <option value="VERBATIM">💬 Verbatim</option>
          <option value="AVIS">🗣️ Avis</option>
          <option value="ALERTE">🚨 Alerte</option>
          <option value="PROLONGEMENT">↪️ Prolongement</option>
        </select>
        <select class="filter-select" data-filter="hashtag" id="filter-hashtag" title="Filtrer par hashtag" aria-label="Filtrer par hashtag">
          <option value="">#️⃣ Tous</option>
        </select>
        <select class="filter-select" data-filter="month" id="filter-month" title="Filtrer par date" aria-label="Filtrer par date"></select>
      </div>
    </div>
  </div>
<div class="pane-body">
  <div class="table-scroll hover-scroll">
    <table class="table" id="activities-table">
      <colgroup><col class="col-type"/><col class="col-actions"/><col class="col-consultant"/><col class="col-main"/></colgroup>
      <thead><tr><th>Type</th><th>Actions</th><th>Consultant</th><th>Titre &amp; détails</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>
</section>
<!-- GUIDÉES -->
<section class="view" id="view-guidee">
  <div class="pane" id="guidee-pane">
    <div class="pane-header">
      <div class="row space guidee-header">
        <div class="row" style="gap:10px;flex-wrap:wrap">
          <div class="title">🧭 Guidées</div>
          <button class="btn small primary" id="btn-new-guidee">Créer</button>
          <button class="btn small" id="btn-edit-guidee">Éditer</button>
          <button class="btn small" id="btn-reset-guidee-filters">Réinitialiser</button>
        </div>
        <div class="row guidee-filters">
          <select id="filter-guidee-consultant" title="Filtrer par consultant">
            <option value="">👤 Tous</option>
          </select>
          <select id="filter-guidee" title="Filtrer par guidée">
            <option value="">🧭 Toutes</option>
          </select>
        </div>
      </div>
      <div id="guidee-progress" class="guidee-progress hidden">
        <div class="guidee-progress-bar"><span></span></div>
        <div class="guidee-progress-label">0% | 0h</div>
      </div>
    </div>
    <div class="pane-body">
      <div class="timeline-scroll hover-scroll">
        <div id="guidee-timeline" class="timeline"></div>
      </div>
    </div>
  </div>
</section>
<!-- REPORTING -->
<section class="view" id="view-reporting">
  <div class="reporting-pane">
    <div class="card">
      <div class="title">📈 Reporting</div>
      <div class="reporting-toolbar">
        <div class="reporting-toolbar-group reporting-toolbar-dates">
          <label for="reporting-start-date">Du
            <input type="date" id="reporting-start-date"/>
          </label>
          <label for="reporting-end-date">Au
            <input type="date" id="reporting-end-date"/>
          </label>
        </div>
        <div class="spacer"></div>
        <div class="reporting-toolbar-group reporting-toolbar-actions">
          <button class="btn small" type="button" id="btn-reporting-copy">Copier texte</button>
          <button class="btn small" type="button" id="btn-reporting-copy-html">Copier HTML</button>
        </div>
      </div>
      <div id="reporting-document" class="reporting-document"></div>
    </div>
  </div>
</section>
<!-- RÉGLAGES -->
<section class="view" id="view-reglages">
<div class="reglages-toolbar">
  <button class="btn primary small" id="btn-save-params">Enregistrer</button>
</div>
<div class="reglages-grid">
  <div class="card">
    <div class="card-header">
      <div class="title">⚙️ Paramètres</div>
    </div>
    <div class="grid" style="grid-template-columns:repeat(2,minmax(0,1fr));gap:8px;margin-top:8px">
      <label>sync_interval_minutes <input type="number" id="p-sync_interval" min="1"/></label>
            <label>fin_mission_sous_jours <input type="number" id="p-fin_mission_sous" min="1"/></label>
      <label>stb_recent_jours <input type="number" id="p-stb_recent" min="1"/></label>
      <label>avis_manquant_depuis_jours <input type="number" id="p-avis_manquant" min="1"/></label>
      <label>activites_recent_jours <input type="number" id="p-activites_recent" min="1"/></label>
      <label>activites_a_venir_jours <input type="number" id="p-activites_avenir" min="1"/></label>
    </div>
    <label style="grid-column:1/-1">Liste des hashtags disponibles (séparés par un espace)
      <textarea id="p-hashtags" rows="4" placeholder="#ProductBacklogPrioritization #ProductUserStories …"></textarea>
    </label>
    <label style="grid-column:1/-1">Utilisateurs @ disponibles (séparés par un espace)
      <textarea id="p-mentions" rows="2" placeholder="@SherpaCoach @TeamLead"></textarea>
    </label>
    <div class="backup-block">
      <div class="subtitle">Backup</div>
      <div class="row" style="gap:8px;flex-wrap:wrap">
        <button class="btn small" id="btn-import-json">⬆️ Import JSON</button>
        <button class="btn small" id="btn-export-json">⬇️ Export JSON</button>
        <button class="btn small" id="btn-reset-firestore" title="Écrase Firestore avec la donnée locale">🔥 Reset Firestore</button>
        <button class="btn small" id="btn-reset-local" title="Remplace la donnée locale par Firestore">🗑️ Reset Local</button>
      </div>
    </div>
  </div>
  <div class="card">
    <div class="title">📋 Templates de description</div>
    <p class="sub">Sélectionnez un template pour le modifier.</p>
    <label for="template-type">Type de template</label>
    <select id="template-type"></select>
    <label for="template-editor">Contenu du template</label>
    <textarea id="template-editor" rows="12"></textarea>
    <div class="row" style="margin-top:8px;gap:8px;flex-wrap:wrap">
      <button class="btn small" id="btn-reset-template">Réinitialiser</button>
    </div>
  </div>
  <div class="card">
    <div class="title">🤖 Prompt IA</div>
    <p class="sub">Personnalisez le prompt commun et le contexte additionnel appliqué aux activités.</p>
    <label for="prompt-editor">Prompt commun aux descriptions</label>
    <textarea id="prompt-editor" rows="8"></textarea>
    <label for="prompt-activity-context">Contexte ajouté aux prompts d’activité</label>
    <textarea id="prompt-activity-context" rows="4"></textarea>
    <label for="prompt-title">Prompt pour suggérer les titres d’activité</label>
    <textarea id="prompt-title" rows="6"></textarea>
    <div class="row" style="margin-top:8px;gap:8px;flex-wrap:wrap">
      <button class="btn small" id="btn-reset-prompt">Réinitialiser</button>
    </div>
  </div>
</div>
</section>
</main>
<!-- MODALES -->
<dialog id="dlg-activity"><form method="dialog" class="modal" id="form-activity">
<div class="row space modal-header">
<h3>✏️ Activité</h3>
<div class="row" style="gap:6px">
<button type="button" class="btn small" id="fa-goto-consultant">👤Consultant</button>
<button type="button" class="btn small" id="fa-goto-guidee">🧭Guidée</button>
<button type="button" class="btn ghost modal-close" data-close="dlg-activity" aria-label="Fermer">✕</button>
</div>
</div>
<div class="grid2">
<div class="field-pair" id="fa-consultant-guidee-row"><label>Consultant <select name="consultant_id" required id="fa-consultant"></select></label>
<label>Guidée <select name="guidee_id" id="fa-guidee"></select></label></div>
<div class="field-pair" id="fa-type-date-row"><label>Type <select name="type" required id="fa-type">
<option value="ACTION_ST_BERNARD">🐕‍🦺 Action STB</option><option value="CORDEE">🪢 Cordée</option><option value="NOTE">📝 Note</option>
<option value="VERBATIM">💬 Verbatim</option><option value="AVIS">🗣️ Avis</option><option value="ALERTE">🚨 Alerte</option><option value="PROLONGEMENT">↪️ Prolongement</option>
</select></label>
<label>Date <input type="date" name="date_publication" required id="fa-date"/></label></div>
<label class="field-with-action">Titre*
  <div class="input-with-action">
    <input id="fa-title" name="title" required maxlength="160" placeholder="Résumé de l’activité"/>
    <button type="button" class="btn ghost small ai-helper" id="fa-title-ai" title="Suggérer un titre à partir de la description">✨</button>
  </div>
</label>
<label id="fa-probability-wrap" class="hidden">Probabilité
  <select id="fa-probability">
    <option value="">Sélectionner</option>
    <option value="OUI">Oui</option>
    <option value="PROBABLE">Probable</option>
    <option value="INCERTAIN">Incertain</option>
    <option value="IMPROBABLE">Improbable</option>
    <option value="NON">Non</option>
  </select>
</label>
<label id="fa-alert-status-wrap" class="hidden">Statut de l'alerte
  <select id="fa-alert-status">
    <option value="MAJEUR">Majeur</option>
    <option value="MINEUR">Mineur</option>
    <option value="INACTIF">Inactif</option>
  </select>
</label>
<div id="fa-alert-type-wrap" class="hidden alert-type-select"><label>Type d'alerte
  <select id="fa-alert-type-select">
    <option value="RH">RH</option>
    <option value="RH_CO">RH/CO</option>
    <option value="CO" selected>CO</option>
  </select>
</label></div>
<label id="fa-heures-wrap" class="hidden">Heures réalisées <select name="heures" id="fa-heures"></select></label>
<label style="grid-column:1/-1" class="field-with-action">Description
  <div class="textarea-with-action">
    <textarea name="description" id="fa-desc" class="description-field" placeholder="#Team #Tech #Data #Customer #Design #Product"></textarea>
    <button type="button" class="btn ghost small ai-helper" id="fa-openai" title="Générer une description structurée">✨</button>
  </div>
</label>
</div>
    <div class="actions"><button type="button" class="btn danger" data-action="delete">Supprimer</button><button type="button" class="btn" data-action="duplicate">Dupliquer</button><button value="ok" class="btn primary">Enregistrer</button></div>
</form></dialog>
<dialog id="dlg-guidee"><form method="dialog" class="modal" id="form-guidee">
  <div class="row space modal-header">
    <h3>✏️ Guidée</h3>
    <div class="row" style="gap:6px">
      <button type="button" class="btn small" id="fg-edit-consultant">👤Consultant</button>
      <button type="button" class="btn ghost modal-close" data-close="dlg-guidee" aria-label="Fermer">✕</button>
    </div>
  </div>
  <div class="grid2">
    <label>Consultant* <select id="fg-consultant" required></select></label>
    <label class="field-with-action" style="grid-column:1/-1">Nom de la guidée*
      <div class="input-with-action">
        <input id="fg-nom" required placeholder="Titre de la guidée"/>
        <button type="button" class="btn ghost small ai-helper" id="fg-title-ai" title="Suggérer un titre à partir de la description">✨</button>
      </div>
    </label>
    <label>Date de début* <input type="date" id="fg-debut" required/></label>
    <label>Date de fin* <input type="date" id="fg-fin" required/></label>
    <label style="grid-column:1/-1" class="field-with-action">Description
      <div class="textarea-with-action">
        <textarea id="fg-desc" class="description-field" placeholder="#Team #Tech #Data #Customer #Design #Product"></textarea>
        <button type="button" class="btn ghost small ai-helper" id="fg-openai" title="Générer une description avec OpenAI">✨</button>
      </div>
    </label>
    <label style="grid-column:1/-1" class="field-with-action">Résultat
      <div class="textarea-with-action">
        <textarea id="fg-result" class="description-field" placeholder="#Team #Tech #Data #Customer #Design #Product"></textarea>
        <button type="button" class="btn ghost small ai-helper" id="fg-result-ai" title="Générer un résultat avec OpenAI">✨</button>
      </div>
    </label>
  </div>
<div class="actions"><button value="del" class="btn danger">Supprimer</button><button type="button" class="btn" data-action="duplicate">Dupliquer</button><button value="ok" class="btn primary">Enregistrer</button></div>
</form></dialog>
<dialog id="dlg-consultant"><form method="dialog" class="modal" id="form-consultant">
<div class="row space modal-header">
<h3>✏️ Consultant</h3>
<div class="row" style="gap:6px">
<button type="button" class="btn small" id="fc-goto-guidees">🧭 Guidées</button>
<a class="btn small" id="fc-boond-link" href="#" target="_blank" rel="noopener" aria-disabled="true">🟧 BoondManager</a>
<button type="button" class="btn ghost modal-close" data-close="dlg-consultant" aria-label="Fermer">✕</button>
</div>
</div>
<div class="grid2">
<label>Nom* <input name="nom" required id="fc-nom"/></label>
<label>Boond Id <input name="boond_id" id="fc-boond" placeholder="12345"/></label>
<label style="grid-column:1/-1">Titre mission <input name="titre_mission" id="fc-titre"/></label>
<label>Date fin (dispo) <input type="date" name="date_fin" id="fc-fin"/></label>
<label style="grid-column:1/-1" class="field-with-action">Description
  <div class="textarea-with-action">
    <textarea name="description" id="fc-desc" class="description-field" placeholder="#Team #Tech #Data #Customer #Design #Product"></textarea>
    <button type="button" class="btn ghost small ai-helper" id="fc-openai" title="Générer une description avec OpenAI">✨</button>
  </div>
</label>
</div>
<div class="actions"><button value="del" class="btn danger">Supprimer</button><button value="ok" class="btn primary">Enregistrer</button></div>
</form></dialog>
<dialog id="dlg-settings-guard"><form method="dialog" class="modal confirm-modal">
  <h3>Enregistrer les paramètres ?</h3>
  <p>Des paramètres modifiés ne sont pas enregistrés. Souhaitez-vous les enregistrer avant de continuer ?</p>
  <div class="actions">
    <button value="stay" class="btn ghost">Rester</button>
    <button value="discard" class="btn">Annuler</button>
    <button value="save" class="btn primary">Enregistrer</button>
  </div>
</form></dialog>
<script src="config.js" defer></script>
<script src="app.js" defer></script>
</body></html>
